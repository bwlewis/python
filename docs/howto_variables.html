<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Variables: Creation, Initialization, Saving, and Loading</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/textmate.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">TensorFlow&trade; for R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Get Started
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="index.html">Introduction</a>
    </li>
    <li>
      <a href="basic_usage.html">Basic Usage</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    How To
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="howto_variables.html">Using TensorFlow Variables</a>
    </li>
    <li>
      <a href="tutorial_tensorflow_mechanics.html">TensorFlow Mechanics 101</a>
    </li>
    <li>
      <a href="howto_summaries_and_tensorboard.html">TensorBoard: Visualizing Learning</a>
    </li>
    <li>
      <a href="howto_graph_viz.html">TensorBoard: Graph Visualization</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">MNIST</li>
    <li>
      <a href="tutorial_mnist_beginners.html">MNIST For ML Beginners</a>
    </li>
    <li>
      <a href="tutorial_mnist_pros.html">Deep MNIST for Experts</a>
    </li>
    <li>
      <a href="tutorial_tensorflow_mechanics.html">TensorFlow Mechanics 101</a>
    </li>
  </ul>
</li>
<li>
  <a href="using_tensorflow_api.html">API</a>
</li>
<li>
  <a></a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jjallaire/tensorflow">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Variables: Creation, Initialization, Saving, and Loading</h1>

</div>


<p>When you train a model, you use <a href="https://www.tensorflow.org/api_docs/python/state_ops.html">variables</a> to hold and update parameters. Variables are in-memory buffers containing tensors. They must be explicitly initialized and can be saved to disk during and after training. You can later restore saved values to exercise or analyze the model.</p>
<p>This document references the following TensorFlow classes. Follow the links to their reference manual for a complete description of their API:</p>
<ul>
<li>The <a href="https://www.tensorflow.org/api_docs/python/state_ops.html#Variable"><code>tf$Variable</code></a> class.</li>
<li>The <a href="https://www.tensorflow.org/api_docs/python/state_ops.html#Saver"><code>tf$train$Saver</code></a> class.</li>
</ul>
<div id="creation" class="section level2">
<h2>Creation</h2>
<p>When you create a <a href="https://www.tensorflow.org/api_docs/python/state_ops.html">Variable</a> you pass a <code>Tensor</code> as its initial value to the <code>Variable()</code> constructor. TensorFlow provides a collection of ops that produce tensors often used for initialization from <a href="https://www.tensorflow.org/api_docs/python/constant_op.html">constants or random values</a>.</p>
<p>Note that all these ops require you to specify the shape of the tensors. That shape automatically becomes the shape of the variable. Variables generally have a fixed shape, but TensorFlow provides advanced mechanisms to reshape variables.</p>
<pre class="r"><code># Create two variables.
weights &lt;- tf$Variable(tf$random_normal(shape(784L, 200L), stddev=0.35),
                       name=&quot;weights&quot;)
biases &lt;- tf$Variable(tf$zeros(shape(200L), name=&quot;biases&quot;))</code></pre>
<p>Calling <code>tf$Variable()</code> adds several ops to the graph:</p>
<ul>
<li>A <code>variable</code> op that holds the variable value.</li>
<li>An initializer op that sets the variable to its initial value. This is actually a <code>tf$assign</code> op.</li>
<li>The ops for the initial value, such as the <code>zeros</code> op for the <code>biases</code> variable in the example are also added to the graph.</li>
</ul>
<p>The value returned by <code>tf$Variable()</code> value is an instance of the Python class <code>tf$Variable</code>.</p>
<div id="device-placement" class="section level3">
<h3>Device placement</h3>
<p>A variable can be pinned to a particular device when it is created, using a <a href="https://www.tensorflow.org/api_docs/python/framework.html#device"><code>with(tf$device(...), {})</code></a> block:</p>
<pre class="r"><code># Pin a variable to CPU.
with(tf$device(&quot;/cpu:0&quot;), {
  v &lt;- tf$Variable(...)
})
 

# Pin a variable to GPU.
with(tf$device(&quot;/gpu:0&quot;), {
  v &lt;- tf$Variable(...)
})

# Pin a variable to a particular parameter server task.
with(tf$device(&quot;/job:ps/task:7&quot;), {
  v &lt;- tf$Variable(...)
})</code></pre>
<p><strong>N.B.</strong> Operations that mutate a variable, such as <a href="https://www.tensorflow.org/api_docs/python/state.html#Variable.assign"><code>v$assign()</code></a> and the parameter update operations in a <a href="https://www.tensorflow.org/api_docs/python/train.html#Optimizer"><code>tf$train$Optimizer</code></a> <em>must</em> run on the same device as the variable. Incompatible device placement directives will be ignored when creating these operations.</p>
<p>Device placement is particularly important when running in a replicated setting. See <a href="https://www.tensorflow.org/api_docs/python/train.html#replica_device_setter"><code>tf$train$replica_device_setter()</code></a> for details of a device function that can simplify the configuration for devices for a replicated model.</p>
</div>
</div>
<div id="initialization" class="section level2">
<h2>Initialization</h2>
<p>Variable initializers must be run explicitly before other ops in your model can be run. The easiest way to do that is to add an op that runs all the variable initializers, and run that op before using the model.</p>
<p>You can alternatively restore variable values from a checkpoint file, see below.</p>
<p>Use <code>tf$initialize_all_variables()</code> to add an op to run variable initializers. Only run that op after you have fully constructed your model and launched it in a session.</p>
<pre class="r"><code># Create two variables.
weights &lt;- tf$Variable(tf$random_normal(shape(784L, 200L), stddev=0.35),
                       name=&quot;weights&quot;)
biases &lt;- tf$Variable(tf$zeros(shape(200), name=&quot;biases&quot;))

# Add an op to initialize the variables.
init_op &lt;- tf$initialize_all_variables()

# Later, when launching the model
with(tf$Session() %as% sess, {
  # Run the init operation.
  sess$run(init_op)
  # Use the model
  # ...
})</code></pre>
<div id="initialization-from-another-variable" class="section level3">
<h3>Initialization from another Variable</h3>
<p>You sometimes need to initialize a variable from the initial value of another variable. As the op added by <code>tf$initialize_all_variables()</code> initializes all variables in parallel you have to be careful when this is needed.</p>
<p>To initialize a new variable from the value of another variable use the other variable’s <code>initialized_value()</code> property. You can use the initialized value directly as the initial value for the new variable, or you can use it as any other tensor to compute a value for the new variable.</p>
<pre class="r"><code># Create a variable with a random value.
weights &lt;- tf$Variable(tf$random_normal(shape(784L, 200L), stddev=0.35),
                       name=&quot;weights&quot;)
# Create another variable with the same value as &#39;weights&#39;.
w2 &lt;- tf$Variable(weights$initialized_value(), name=&quot;w2&quot;)
# Create another variable with twice the value of &#39;weights&#39;
w_twice &lt;- tf$Variable(weights$initialized_value() * 2.0, name=&quot;w_twice&quot;)</code></pre>
</div>
<div id="custom-initialization" class="section level3">
<h3>Custom Initialization</h3>
<p>The convenience function <code>tf$initialize_all_variables()</code> adds an op to initialize <em>all variables</em> in the model. You can also pass it an explicit list of variables to initialize. See the <a href="https://www.tensorflow.org/api_docs/python/state_ops.html">Variables Documentation</a> for more options, including checking if variables are initialized.</p>
</div>
</div>
<div id="saving-and-restoring" class="section level2">
<h2>Saving and Restoring</h2>
<p>The easiest way to save and restore a model is to use a <code>tf$train$Saver</code> object. The constructor adds <code>save</code> and <code>restore</code> ops to the graph for all, or a specified list, of the variables in the graph. The saver object provides methods to run these ops, specifying paths for the checkpoint files to write to or read from.</p>
<div id="checkpoint-files" class="section level3">
<h3>Checkpoint Files</h3>
<p>Variables are saved in binary files that, roughly, contain a map from variable names to tensor values.</p>
<p>When you create a <code>Saver</code> object, you can optionally choose names for the variables in the checkpoint files. By default, it uses the value of the <a href="https://www.tensorflow.org/api_docs/python/state_ops.html#Variable.name"><code>Variable.name</code></a> property for each variable.</p>
<p>To understand what variables are in a checkpoint, you can use the <a href="https://www.tensorflow.org/code/tensorflow/python/tools/inspect_checkpoint.py"><code>inspect_checkpoint</code></a> library, and in particular, the <code>print_tensors_in_checkpoint_file</code> function.</p>
</div>
<div id="saving-variables" class="section level3">
<h3>Saving Variables</h3>
<p>Create a <code>Saver</code> with <code>tf$train$Saver()</code> to manage all variables in the model.</p>
<pre class="r"><code># Create some variables.
v1 &lt;- tf$Variable(..., name=&quot;v1&quot;)
v2 &lt;- tf$Variable(..., name=&quot;v2&quot;)
...
# Add an op to initialize the variables.
init_op &lt;- tf$initialize_all_variables()

# Add ops to save and restore all the variables.
saver &lt;- tf$train$Saver()

# Later, launch the model, initialize the variables, do some work, save the
# variables to disk.
with(tf$Session() %as% sess, {
  sess$run(init_op)
  # Do some work with the model.
  ..
  # Save the variables to disk.
  save_path &lt;- saver$save(sess, &quot;/tmp/model.ckpt&quot;)
  cat(sprintf(&quot;Model saved in file: %s\n&quot;, save_path))
})</code></pre>
</div>
<div id="restoring-variables" class="section level3">
<h3>Restoring Variables</h3>
<p>The same <code>Saver</code> object is used to restore variables. Note that when you restore variables from a file you do not have to initialize them beforehand.</p>
<pre class="r"><code># Create some variables.
v1 &lt;- tf$Variable(..., name=&quot;v1&quot;)
v2 = tf$Variable(..., name=&quot;v2&quot;)
...
# Add ops to save and restore all the variables.
saver &lt;- tf$train$Saver()

# Later, launch the model, use the saver to restore variables from disk, and
# do some work with the model.
with(tf$Session() %as% sess, {
  # Restore variables from disk.
  saver$restore(sess, &quot;/tmp/model.ckpt&quot;)
  cat(&quot;Model restored.\n&quot;)
  # Do some work with the model
  ...
})</code></pre>
</div>
<div id="choosing-which-variables-to-save-and-restore" class="section level3">
<h3>Choosing which Variables to Save and Restore</h3>
<p>If you do not pass any argument to <code>tf$train$Saver()</code> the saver handles all variables in the graph. Each one of them is saved under the name that was passed when the variable was created.</p>
<p>It is sometimes useful to explicitly specify names for variables in the checkpoint files. For example, you may have trained a model with a variable named <code>&quot;weights&quot;</code> whose value you want to restore in a new variable named <code>&quot;params&quot;</code>.</p>
<p>It is also sometimes useful to only save or restore a subset of the variables used by a model. For example, you may have trained a neural net with 5 layers, and you now want to train a new model with 6 layers, restoring the parameters from the 5 layers of the previously trained model into the first 5 layers of the new model.</p>
<p>You can easily specify the names and variables to save by passing to the <code>tf$train$Saver()</code> constructor a named list with the appropirate names and values.</p>
<p>Notes:</p>
<ul>
<li><p>You can create as many saver objects as you want if you need to save and restore different subsets of the model variables. The same variable can be listed in multiple saver objects, its value is only changed when the saver <code>restore()</code> method is run.</p></li>
<li><p>If you only restore a subset of the model variables at the start of a session, you have to run an initialize op for the other variables. See <a href="https://www.tensorflow.org/api_docs/python/state_ops.html#initialize_variables"><code>tf$initialize_variables()</code></a> for more information.</p>
<pre class="r"><code># Create some variables.
v1 &lt;- tf$Variable(..., name=&quot;v1&quot;)
v2 &lt;- tf$Variable(..., name=&quot;v2&quot;)

# Add ops to save and restore only &#39;v2&#39; using the name &quot;my_v2&quot;
saver &lt;- tf$train$Saver(dict(my_v2 = v2))
# Use the saver object normally after that.</code></pre></li>
</ul>
</div>
</div>



<footer>
  <div>&nbsp;</div>
  <div>&nbsp;</div>
  <div class="text-muted">
  Copyright &copy; 2015-2016 The TensorFlow Authors and RStudio, Inc.
  </div>
</footer>



</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
